<!DOCTYPE html>
<html>
<head>
    <title>VS2022 Converter</title>
    <style>
        #convertBtn {
            padding: 20px 40px;
            font-size: 16px;
        }

        #convertBtn:disabled {
            background: #777;
            animation: rgbBad 2s linear infinite;
            cursor: not-allowed;
        }

    @keyframes rgbRotate {
            0%   { background: red; }
            33%  { background: green; }
            66%  { background: blue; }
            100% { background: red; }
        }
    
    @keyframes rgbBad{
            0% {background: red}
            100% {background: blue}
        }

    @keyframes runH {
            0% {left: 0%}
            50% {left: 100%}
            100% {left: 0%}
        
        }

    @keyframes runV {
        0%   { transform: translateY(0px); }
        50%  { transform: translateY(400px); }
        100% { transform: translateY(0px); }
        }

        #convertBtn.enabled {
            color: white;
            position: relative;
            animation: rgbRotate 3s linear infinite,
            runH 1s linear infinite,
            runV 1.5s linear infinite;
        }


        #dropZone {
            width: 100%;
            height: 100px;
            border: 2px dashed #aaa;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            cursor: pointer;
        }

        #fileList {
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 5px;
        }

        #fileList div {
            padding: 2px 0;
            font-family: monospace;
        }
    </style>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<h2>VS2022 Converter</h2>

<select id="modeSelect">
    <option value="files">Select Files</option>
    <option value="folder">Select Folder</option>
</select>

<input type="file" id="fileInput" accept=".cpp,.h,.hpp" style="display:none" multiple>
<div id="dropZone">Drag files/folder here or click</div>

<div id="fileList"></div>

<div id="convertWrapper">
    <button id="convertBtn" disabled>Choose a file or I zip bomb you</button>
</div>

<script>
const fileInput = document.getElementById("fileInput");
const convertBtn = document.getElementById("convertBtn");
const dropZone = document.getElementById("dropZone");
const modeSelect = document.getElementById("modeSelect");
const fileListDiv = document.getElementById("fileList");

let selectedFiles = [];

// Update the button and animation
function updateButtonState() {
    if (selectedFiles.length > 0) {
        convertBtn.disabled = false;
        convertBtn.classList.add("enabled");
        convertBtn.textContent = "Do the thing";
    } else {
        convertBtn.disabled = true;
        convertBtn.classList.remove("enabled");
        convertBtn.textContent = "Choose a file or I zip bomb you";
    }
    updateFileList();
}

function updateFileList() {
    fileListDiv.innerHTML = "";
    selectedFiles.forEach(f => {
        const div = document.createElement("div");
        div.textContent = f.name;
        fileListDiv.appendChild(div);
    });
}

// Clicking drop zone opens file/folder picker
dropZone.onclick = () => fileInput.click();

// Drag-and-drop
dropZone.addEventListener("dragover", e => {
    e.preventDefault();
    dropZone.style.background = "#eef";
});
dropZone.addEventListener("dragleave", () => dropZone.style.background = "");
dropZone.addEventListener("drop", e => {
    e.preventDefault();
    dropZone.style.background = "";
    selectedFiles = Array.from(e.dataTransfer.files);
    updateButtonState();
});

// File input change
fileInput.addEventListener("change", () => {
    selectedFiles = Array.from(fileInput.files);
    updateButtonState();
});

// Mode select for folder picker
modeSelect.addEventListener("change", () => {
    if (modeSelect.value === "folder") {
        fileInput.setAttribute("webkitdirectory", "");
        fileInput.setAttribute("directory", "");
    } else {
        fileInput.removeAttribute("webkitdirectory");
        fileInput.removeAttribute("directory");
    }
});

// Convert button click -> send files to Flask backend
convertBtn.addEventListener("click", async () => {
    if (convertBtn.disabled) return;

    const formData = new FormData();
    selectedFiles.forEach(f => formData.append("files", f));

    const response = await fetch("/convert", { method: "POST", body: formData });
    const blob = await response.blob();
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "VS2022_Converted_Project.zip";
    a.click();
});
</script>
</body>
</html>
